# Hooky - Git Hooks Manager

## Project Overview

**Hooky** is a cross-platform git hooks manager written in Go that provides a simple, distribution-friendly alternative to Husky and pre-commit. It allows teams to manage git hooks without requiring package managers - just a single binary.

### Key Features
- 🚀 Single binary distribution (no package manager required)
- 🌍 Cross-platform (Linux, macOS, Windows, FreeBSD) 
- ⚙️ YAML-based configuration
- 📁 Separate `script` and `command` properties for clarity
- 🛡️ Safe installation with automatic backups
- ✅ Validation of scripts and commands before installation
- 📝 Rich logging and clear error messages

## Architecture

### Core Components

1. **main.go** - CLI interface with flags:
   - `--install` - Install hooks from configuration
   - `--uninstall` - Remove hooky-managed hooks  
   - `--list` - Display hooks with validation status
   - `--config` - Specify custom config file
   - `--verbose` - Enable detailed output
   - `--version` - Show version

2. **config.go** - Configuration management:
   - `LoadConfig()` - Parse YAML configuration
   - `validateHookScripts()` - Ensure script XOR command per hook
   - `HookScript` struct with `Script`, `Command`, `Name`, `Description`

3. **manager.go** - Core hook management:
   - `HookManager` - Main orchestrator
   - `InstallHooks()` - Install hooks with validation
   - `UninstallHooks()` - Remove only hooky-generated hooks
   - `validateScripts()` - Check script files exist, commands in PATH
   - `generateHookScript()` - Create executable hook files

### Configuration Format

```yaml
hooks:
  pre-commit:
    - name: "format-check"
      script: "hooks/format.sh"          # Executable file path
      description: "Check code formatting"
    - name: "go-test" 
      command: "go test ./..."           # Direct command
      description: "Run Go tests"

settings:
  auto_executable: true        # Make scripts executable
  backup_existing: true        # Backup existing hooks
  backup_directory: ".hooky-backup"
  verbose: false
```

### Key Design Decisions

1. **Script vs Command Separation**: 
   - `script`: Executable files (validated for existence)
   - `command`: Direct commands (validated in PATH)
   - Mutually exclusive per hook entry

2. **Safe Installation**:
   - Only removes hooks with "Generated by hooky" signature
   - Automatic backup of existing hooks
   - Validation before any changes

3. **Cross-platform Compatibility**:
   - Go for easy compilation across platforms
   - Shell script generation works on Unix-like systems
   - Windows support with bash compatibility

## File Structure

```
hooky/
├── main.go              # CLI entry point
├── config.go            # Configuration parsing & validation  
├── manager.go           # Hook installation & management
├── hooky.yaml           # Example configuration
├── hooks/               # Example hook scripts
│   ├── format.sh        # Code formatting example
│   ├── lint.sh          # Linting example  
│   ├── test.sh          # Testing example
│   └── ...              # More examples
├── *_test.go            # Comprehensive test suite
├── build.sh             # Cross-platform build script
├── Makefile             # Development workflows
├── .github/             # CI/CD workflows
└── docs/                # Documentation
```

## Test Suite

**Coverage: 70.8%** with comprehensive testing:

- **config_test.go** - Configuration parsing & validation
- **manager_test.go** - Hook management functionality
- **validation_test.go** - Script/command validation with edge cases  
- **integration_test.go** - Full workflow & CLI testing

### Running Tests
```bash
go test -v              # All tests
go test -cover          # With coverage
go test -short          # Skip integration tests
```

## Development Workflows

```bash
# Development
make dev                # Format, lint, test, build
make build              # Build for current platform
make build-all          # Cross-platform builds

# Testing
make test               # Run test suite
go test -v              # Verbose test output

# Release
make release            # Full release workflow
```

## Common Usage Patterns

### Basic Setup
```bash
# 1. Download binary for platform
curl -L -o hooky https://github.com/user/hooky/releases/latest/download/hooky-linux-amd64.tar.gz

# 2. Create configuration
cat > hooky.yaml << 'EOF'
hooks:
  pre-commit:
    - name: "format"
      command: "go fmt ./..."
      description: "Format Go code"
EOF

# 3. Install hooks
./hooky --install
```

### Development Workflow
```bash
./hooky --list          # Check configuration & validation
./hooky --install       # Install hooks
git commit -m "test"    # Hooks run automatically
./hooky --uninstall     # Remove when needed
```

## Version History

- **v1.3.0** - Current version with script/command separation
- **v1.2.0** - Added smart command detection (deprecated)
- **v1.1.0** - Removed hooks_directory, direct script paths
- **v1.0.0** - Initial release

## Key Implementation Details

### Hook Script Generation
- Uses Go templates to generate shell scripts
- Each hook entry becomes a section in the generated script
- Scripts get `"$@"` arguments passed through
- Commands executed with `cd` to working directory
- Proper error handling with exit codes

### Validation Logic
- **Scripts**: Check file existence, handle arguments by parsing first word
- **Commands**: Use `exec.LookPath()` to verify command availability
- **Configuration**: Enforce script XOR command per hook entry

### Safety Features
- Only removes hooks containing "Generated by hooky" signature
- Automatic backup before installing new hooks
- Validation prevents broken hook installation
- Clear error messages for missing dependencies

## Future Claude Context

When working on this project:

1. **The architecture is stable** - Core design decisions are well-tested
2. **Tests are comprehensive** - Run tests before major changes
3. **Cross-platform compatibility** is important - test on multiple platforms  
4. **Validation is crucial** - Don't skip script/command validation
5. **Safety first** - Maintain backup and signature-checking behavior
6. **User experience matters** - Clear error messages and helpful output

## Common Tasks

- **Adding new hook types**: Update `GetSupportedHooks()` in config.go
- **Modifying validation**: Update `validateScripts()` in manager.go  
- **Changing configuration**: Update structs in config.go + add tests
- **CLI changes**: Modify main.go + update documentation
- **New features**: Add tests first, then implement

The codebase is well-structured, thoroughly tested, and ready for continued development.